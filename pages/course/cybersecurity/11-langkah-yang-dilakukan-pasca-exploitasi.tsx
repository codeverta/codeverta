import React, { useState } from "react";

// Komponen untuk ikon (menggunakan SVG inline agar tidak perlu instal library ikon)
const IconChevronDown = ({ className }) => (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    className={className}
    fill="none"
    viewBox="0 0 24 24"
    stroke="currentColor"
  >
    <path
      strokeLinecap="round"
      strokeLinejoin="round"
      strokeWidth={2}
      d="M19 9l-7 7-7-7"
    />
  </svg>
);

const IconShieldCheck = () => (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    className="h-6 w-6 mr-3 text-emerald-400"
    fill="none"
    viewBox="0 0 24 24"
    stroke="currentColor"
  >
    <path
      strokeLinecap="round"
      strokeLinejoin="round"
      strokeWidth={2}
      d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 20.944L12 22l9-1.056c-1.5-4.84-5.02-9.222-9.382-11.972z"
    />
  </svg>
);

const techniqueData = [
  {
    title: "1. Privilege Escalation (Peningkatan Hak Akses)",
    content: {
      description:
        "Setelah mendapatkan akses awal (seringkali sebagai pengguna biasa), tujuan pertama adalah mendapatkan hak akses tertinggi (Administrator/ROOT). Ini adalah kunci untuk menguasai sistem sepenuhnya.",
      windows: {
        title: "Contoh di Windows:",
        points: [
          '**Kernel Exploits:** Mengeksploitasi kerentanan pada inti Windows (e.g., "Juicy Potato", "Rotten Potato").',
          "**Unquoted Service Paths:** Jika path ke sebuah service tidak diapit tanda kutip dan mengandung spasi, kita bisa menanam file berbahaya yang akan dieksekusi dengan hak akses sistem.",
          "**Stored Credentials:** Mencari password yang disimpan dalam file konfigurasi, registry, atau script.",
          "**DLL Hijacking:** Menempatkan file DLL berbahaya di lokasi yang akan dimuat oleh aplikasi yang berjalan dengan hak akses tinggi.",
        ],
        tools: ["PowerUp.ps1", "WinPEAS", "Metasploit Modules"],
      },
      linux: {
        title: "Contoh di Linux:",
        points: [
          '**Kernel Exploits:** Mirip dengan Windows, menargetkan kerentanan pada kernel Linux (e.g., "Dirty COW").',
          "**SUID/SGID Binaries:** Mencari file program yang memiliki bit SUID/SGID. Jika program ini dapat dimanipulasi, kita bisa menjalankan perintah sebagai pemilik file tersebut (seringkali root).",
          "**Cron Jobs:** Memeriksa cron jobs (tugas terjadwal) yang dapat ditulis. Jika sebuah script yang dijalankan oleh root bisa kita modifikasi, kita bisa menyisipkan kode berbahaya.",
          "**Sudo Misconfigurations:** Mengeksploitasi hak `sudo` yang diberikan secara berlebihan kepada pengguna.",
        ],
        tools: ["LinEnum.sh", "LinPEAS.sh", "GTFOBins"],
      },
    },
  },
  {
    title: "2. Lateral Movement (Pergerakan Lateral)",
    content: {
      description:
        "Teknik menyebar dari sistem pertama yang dikompromikan ke sistem lain di dalam jaringan. Tujuannya adalah untuk menemukan aset yang lebih berharga seperti Domain Controller, database server, atau file server.",
      windows: {
        title: "Metode Umum di Lingkungan Windows (Active Directory):",
        points: [
          "**Pass-the-Hash (PtH):** Menggunakan hash NTLM dari password pengguna untuk otentikasi ke mesin lain tanpa perlu mengetahui password aslinya.",
          "**Pass-the-Ticket (PtT):** Menggunakan tiket Kerberos yang dicuri untuk mengakses layanan lain di jaringan.",
          "**Credential Dumping:** Mengambil username dan password dari memori (LSASS process) menggunakan alat seperti Mimikatz.",
          "**Remote Services:** Memanfaatkan layanan seperti WinRM, RDP, atau PsExec untuk menjalankan perintah di mesin target.",
        ],
        tools: [
          "Mimikatz",
          "PsExec",
          "CrackMapExec",
          "Metasploit (psexec module)",
        ],
      },
      linux: {
        title: "Metode Umum di Lingkungan Linux/Unix:",
        points: [
          "**SSH Hopping:** Menggunakan kunci SSH yang ditemukan di mesin pertama untuk login ke mesin lain.",
          "**NFS Exploitation:** Memanfaatkan share NFS (Network File System) yang tidak dikonfigurasi dengan aman.",
          "**Reusing Credentials:** Mencoba kembali password yang ditemukan di mesin pertama untuk login ke layanan lain (SSH, VNC, FTP) di mesin berbeda.",
        ],
        tools: ["SSH", "Nmap (untuk scan port)", "Metasploit"],
      },
    },
  },
  {
    title: "3. Persistence (Mekanisme Persistensi)",
    content: {
      description:
        'Memastikan akses tetap ada bahkan setelah sistem di-restart, password diubah, atau patch keamanan diterapkan. Ini adalah cara membuat "pintu belakang" (backdoor) yang permanen.',
      windows: {
        title: "Contoh di Windows:",
        points: [
          "**Registry Run Keys:** Menambahkan path ke program berbahaya di `HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run`.",
          "**Scheduled Tasks:** Membuat tugas terjadwal yang menjalankan script atau program berbahaya secara periodik.",
          "**Startup Folder:** Menempatkan file LNK atau executable di folder Startup pengguna.",
          "**WMI Event Subscription:** Membuat event WMI yang akan memicu eksekusi kode berbahaya.",
        ],
        tools: ["schtasks.exe", "reg.exe", "Metasploit persistence modules"],
      },
      linux: {
        title: "Contoh di Linux:",
        points: [
          "**Cron Jobs:** Menambahkan perintah berbahaya ke crontab pengguna atau sistem.",
          "**SSH Authorized Keys:** Menambahkan public key milik penyerang ke file `~/.ssh/authorized_keys` agar bisa login tanpa password.",
          "**.bashrc / .profile:** Menambahkan alias atau perintah ke file-file ini yang akan dieksekusi setiap kali shell dibuka.",
          "**Systemd Services:** Membuat service systemd baru yang menjalankan backdoor saat booting.",
        ],
        tools: ["crontab", "systemctl", "SSH"],
      },
    },
  },
  {
    title: "4. Data Exfiltration (Eksfiltrasi Data)",
    content: {
      description:
        "Ini adalah tujuan akhir dari banyak serangan: mencuri data sensitif. Proses ini harus dilakukan secara diam-diam agar tidak memicu sistem deteksi (IDS/IPS/DLP).",
      windows: {
        title: "Metode Umum:",
        points: [
          "**HTTP/HTTPS Tunneling:** Mengenkapsulasi data curian dalam lalu lintas web normal (port 80/443) yang biasanya diizinkan oleh firewall.",
          "**DNS Tunneling:** Menggunakan query DNS untuk mengirimkan potongan-potongan kecil data keluar dari jaringan. Sangat sulit dideteksi.",
          "**ICMP Tunneling:** Menyembunyikan data di dalam paket ping (ICMP).",
          "**Cloud Storage:** Mengunggah data yang dikompres dan dienkripsi ke layanan cloud publik seperti Dropbox atau Google Drive.",
        ],
        tools: [
          "dns2tcp",
          "icmptunnel",
          "PowerShell (Invoke-WebRequest)",
          "rclone",
        ],
      },
      linux: {
        title: "",
        points: [],
        tools: [],
      },
    },
  },
  {
    title: "5. Covering Tracks (Menghapus Jejak)",
    content: {
      description:
        "Langkah terakhir untuk menghilangkan bukti intrusi. Tujuannya adalah menunda deteksi, mempersulit analisis forensik, dan memungkinkan penyerang untuk kembali lagi tanpa diketahui.",
      windows: {
        title: "Tindakan di Windows:",
        points: [
          "**Clear Event Logs:** Menggunakan perintah `wevtutil cl <LogName>` untuk membersihkan log Security, System, dan Application.",
          "**File Deletion:** Menggunakan `cipher.exe` atau `sdelete` untuk menghapus file secara aman (menimpa data) sehingga tidak bisa dipulihkan.",
          "**Timestamp Manipulation:** Mengubah waktu (Modified, Accessed, Created) sebuah file agar sesuai dengan file lain dan tidak mencurigakan.",
        ],
        tools: ["wevtutil", "Metasploit (clearev)", "Timestomp"],
      },
      linux: {
        title: "Tindakan di Linux:",
        points: [
          "**Clear Log Files:** Mengedit atau menghapus konten dari file di `/var/log` (e.g., `auth.log`, `syslog`).",
          "**Wipe Command History:** Menghapus riwayat shell dengan `history -c` atau mengedit file `~/.bash_history`.",
          "**Secure Deletion:** Menggunakan `shred` untuk menimpa file sebelum dihapus.",
        ],
        tools: ["shred", "logrotate (manipulation)", "history"],
      },
    },
  },
];

// Sub-komponen untuk setiap item accordion
const AccordionItem = ({ item, isOpen, onClick }) => {
  const { title, content } = item;

  return (
    <div className="border-b border-gray-700">
      <button
        onClick={onClick}
        className="w-full flex justify-between items-center text-left py-5 px-6 text-lg font-semibold text-gray-200 hover:bg-gray-700 focus:outline-none"
      >
        <span>{title}</span>
        <IconChevronDown
          className={`w-6 h-6 transform transition-transform duration-300 ${
            isOpen ? "rotate-180" : ""
          }`}
        />
      </button>
      <div
        className={`overflow-hidden transition-all duration-500 ease-in-out ${
          isOpen ? "max-h-screen" : "max-h-0"
        }`}
      >
        <div className="p-6 bg-gray-800">
          <p className="text-gray-300 mb-6">{content.description}</p>
          <div className="grid md:grid-cols-2 gap-6">
            {content.windows.title && (
              <div className="bg-gray-700/50 p-4 rounded-lg">
                <h4 className="text-teal-400 font-bold mb-3">
                  {content.windows.title}
                </h4>
                <ul className="list-disc list-inside space-y-2 text-gray-300">
                  {content.windows.points.map((point, index) => (
                    <li
                      key={index}
                      dangerouslySetInnerHTML={{ __html: point }}
                    ></li>
                  ))}
                </ul>
                {content.windows.tools.length > 0 && (
                  <div className="mt-4">
                    <p className="font-semibold text-gray-400">Alat Populer:</p>
                    <code className="text-amber-400">
                      {content.windows.tools.join(", ")}
                    </code>
                  </div>
                )}
              </div>
            )}
            {content.linux.title && (
              <div className="bg-gray-700/50 p-4 rounded-lg">
                <h4 className="text-teal-400 font-bold mb-3">
                  {content.linux.title}
                </h4>
                <ul className="list-disc list-inside space-y-2 text-gray-300">
                  {content.linux.points.map((point, index) => (
                    <li
                      key={index}
                      dangerouslySetInnerHTML={{ __html: point }}
                    ></li>
                  ))}
                </ul>
                {content.linux.tools.length > 0 && (
                  <div className="mt-4">
                    <p className="font-semibold text-gray-400">Alat Populer:</p>
                    <code className="text-amber-400">
                      {content.linux.tools.join(", ")}
                    </code>
                  </div>
                )}
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
};

// Komponen utama halaman
function PostExploitationPage() {
  const [openIndex, setOpenIndex] = useState(null);

  const handleItemClick = (index) => {
    setOpenIndex(openIndex === index ? null : index);
  };

  return (
    <div className="bg-gray-900 text-white min-h-screen p-4 sm:p-6 md:p-10">
      <div className="max-w-4xl mx-auto">
        <header className="text-center mb-10">
          <h1 className="text-4xl md:text-5xl font-bold mb-2 bg-gradient-to-r from-teal-400 to-blue-500 text-transparent bg-clip-text">
            Teknik Pasca-Eksploitasi
          </h1>
          <p className="text-lg text-gray-400">
            Apa yang dilakukan setelah berhasil masuk? Inilah fase krusial dalam
            sebuah serangan siber.
          </p>
        </header>

        <main className="bg-gray-800 rounded-lg shadow-2xl shadow-blue-500/10 overflow-hidden">
          {techniqueData.map((item, index) => (
            <AccordionItem
              key={index}
              item={item}
              isOpen={openIndex === index}
              onClick={() => handleItemClick(index)}
            />
          ))}
        </main>

        <section className="mt-12 bg-gray-800 p-6 rounded-lg">
          <h3 className="text-2xl font-bold mb-4 flex items-center">
            <IconShieldCheck />
            Perspektif Tim Biru (Pertahanan)
          </h3>
          <p className="text-gray-300 mb-4">
            Bagaimana cara mendeteksi dan mencegah aktivitas ini?
          </p>
          <ul className="list-disc list-inside space-y-2 text-gray-300">
            <li>
              <strong>Monitoring Log Terpusat:</strong> Kumpulkan log dari semua
              sistem ke satu tempat (SIEM) untuk mendeteksi anomali seperti
              login gagal berulang kali atau pembersihan log.
            </li>
            <li>
              <strong>Endpoint Detection and Response (EDR):</strong> Gunakan
              EDR untuk memantau aktivitas proses yang mencurigakan, seperti
              `mimikatz.exe` yang berjalan di memori.
            </li>
            <li>
              <strong>Prinsip Hak Akses Terkecil (Least Privilege):</strong>{" "}
              Pastikan pengguna dan layanan hanya memiliki hak akses yang
              benar-benar mereka butuhkan untuk bekerja.
            </li>
            <li>
              <strong>Network Segmentation:</strong> Pisahkan jaringan ke dalam
              segmen-segmen kecil untuk membatasi pergerakan lateral jika satu
              segmen berhasil ditembus.
            </li>
            <li>
              <strong>Egress Filtering:</strong> Batasi lalu lintas keluar dari
              jaringan. Blokir semua port kecuali yang benar-benar dibutuhkan
              (misal, 80/443) untuk mempersulit eksfiltrasi data.
            </li>
          </ul>
        </section>
      </div>
    </div>
  );
}

export default PostExploitationPage;
